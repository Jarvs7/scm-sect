{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import api from\"../../utils/api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ListaViagensPendentes=()=>{const[viagensPendentes,setViagensPendentes]=useState([]);const[motoristas,setMotoristas]=useState([]);const[veiculos,setVeiculos]=useState([]);const[selecoes,setSelecoes]=useState({});useEffect(()=>{const fetchData=async()=>{try{const[viagensRes,motoristasRes,veiculosRes]=await Promise.all([api.get(\"/viagens/pendentes\"),api.get(\"/motoristas/disponiveis\"),api.get(\"/veiculos/disponiveis\")]);setViagensPendentes(viagensRes.data);setMotoristas(motoristasRes.data);setVeiculos(veiculosRes.data);}catch(error){console.error(\"Erro ao carregar dados:\",error);alert(\"Erro ao carregar dados de viagens, motoristas ou veículos\");}};fetchData();},[]);const handleReprovar=async id=>{const motivo=prompt(\"Informe o motivo da reprovação:\");if(!motivo||motivo.trim().length<5){alert(\"Motivo muito curto. Mínimo 5 caracteres.\");return;}try{const response=await api.patch(`/viagens/${id}/rejeitar`,{motivo});if(response.data.success){alert(\"Viagem reprovada com sucesso!\");setViagensPendentes(prev=>prev.filter(v=>v._id!==id));}else{alert(response.data.message||\"Erro ao reprovar viagem.\");}}catch(err){console.error(\"Erro ao reprovar viagem:\",err);alert(\"Erro ao reprovar viagem.\");}};const handleAprovar=async viagemId=>{const selecaoAtual=selecoes[viagemId];if(!(selecaoAtual!==null&&selecaoAtual!==void 0&&selecaoAtual.motorista)||!(selecaoAtual!==null&&selecaoAtual!==void 0&&selecaoAtual.veiculo)){alert(\"Selecione um motorista e um veículo para essa viagem\");return;}try{const user=JSON.parse(localStorage.getItem(\"user\")||\"{}\");const response=await api.patch(`/viagens/${viagemId}/aprovar`,{motorista:selecaoAtual.motorista,veiculo:selecaoAtual.veiculo,aprovador:user._id});if(response.data.success){alert(\"Viagem aprovada com sucesso!\");// Remove viagem da tela\nsetViagensPendentes(prev=>prev.filter(v=>v._id!==viagemId));// Remove motorista/veículo da lista\nsetMotoristas(prev=>prev.filter(m=>m._id!==selecaoAtual.motorista));setVeiculos(prev=>prev.filter(v=>v._id!==selecaoAtual.veiculo));// Limpa seleção\nsetSelecoes(prev=>{const atual={...prev};delete atual[viagemId];return atual;});}else{alert(response.data.message||\"Erro ao aprovar viagem\");}}catch(err){console.error(\"Erro ao aprovar viagem:\",err);alert(\"Erro ao aprovar viagem\");}};return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"mb-4 text-center d-flex align-items-center justify-content-center\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fas fa-calendar-alt me-2\"}),\"Viagens Pendentes\"]}),viagensPendentes.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"Nenhuma Solicita\\xE7\\xE3o Pendente no Momento.\"}):viagensPendentes.map(viagem=>{const selecao=selecoes[viagem._id]||{motorista:\"\",veiculo:\"\"};return/*#__PURE__*/_jsxs(\"div\",{className:`viagem-card ${viagem.tipo===\"urgente\"?\"urgente\":\"\"}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"viagem-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"viagem-info\",children:[/*#__PURE__*/_jsxs(\"h5\",{children:[\"Destino: \",viagem.local,viagem.tipo===\"urgente\"&&/*#__PURE__*/_jsx(\"span\",{className:\"badge-urgente  fas fa-exclamation-triangle\",children:\"   URGENTE\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Setor:\"}),\" \",viagem.setor]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Passageiros:\"}),\" \",viagem.passageiros]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Data/Hora:\"}),\" \",new Date(viagem.saida).toLocaleString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Observa\\xE7\\xF5es:\"}),\" \",viagem.observacoes||\"-\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"selecao-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"select-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Motorista:\"}),/*#__PURE__*/_jsxs(\"select\",{value:selecao.motorista,onChange:e=>setSelecoes(prev=>({...prev,[viagem._id]:{...prev[viagem._id],motorista:e.target.value}})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Selecione...\"}),motoristas.map(m=>/*#__PURE__*/_jsx(\"option\",{value:m._id,children:m.nome},m._id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"select-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Ve\\xEDculo:\"}),/*#__PURE__*/_jsxs(\"select\",{value:selecao.veiculo,onChange:e=>setSelecoes(prev=>({...prev,[viagem._id]:{...prev[viagem._id],veiculo:e.target.value}})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Selecione...\"}),veiculos.map(v=>/*#__PURE__*/_jsx(\"option\",{value:v._id,children:v.nome},v._id))]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"viagem-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-aprovar\",onClick:()=>handleAprovar(viagem._id),disabled:!selecao.motorista||!selecao.veiculo,children:\"Aprovar\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-reprovar\",onClick:()=>handleReprovar(viagem._id),children:\"Reprovar\"})]})]},viagem._id);})]});};export default ListaViagensPendentes;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}