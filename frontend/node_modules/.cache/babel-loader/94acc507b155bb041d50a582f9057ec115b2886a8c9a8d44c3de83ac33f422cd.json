{"ast":null,"code":"import React,{useState,useEffect,useMemo}from\"react\";import api from\"../../utils/api\";import{jsxs as _jsxs,jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||\"http://localhost:1120\";const Filtros=_ref=>{let{onFiltrar,filtrosAtivos,loading:parentLoading}=_ref;const[motoristas,setMotoristas]=useState([]);const[localLoading,setLocalLoading]=useState(false);const[filtros,setFiltros]=useState({dataInicial:(filtrosAtivos===null||filtrosAtivos===void 0?void 0:filtrosAtivos.dataInicial)||\"\",dataFinal:(filtrosAtivos===null||filtrosAtivos===void 0?void 0:filtrosAtivos.dataFinal)||\"\",motorista:(filtrosAtivos===null||filtrosAtivos===void 0?void 0:filtrosAtivos.motorista)||\"todos\",status:(filtrosAtivos===null||filtrosAtivos===void 0?void 0:filtrosAtivos.status)||\"todos\"});const loading=parentLoading||localLoading;useEffect(()=>{let isMounted=true;const carregarMotoristas=async()=>{try{setLocalLoading(true);const response=await api.get(\"/viagens/motoristas\");if(response.status!==200){throw new Error(\"Erro ao carregar motoristas\");}const result=response.data;// Se a resposta já for um array\nconst dados=Array.isArray(result)?result:result.data||[];if(!Array.isArray(dados)){throw new Error(\"Resposta inválida da API de motoristas\");}if(isMounted){setMotoristas(dados.filter(m=>m.status!==\"inativo\"));}}catch(error){console.error(\"Erro ao carregar motoristas:\",error);}finally{if(isMounted)setLocalLoading(false);}};carregarMotoristas();return()=>{isMounted=false;};},[]);const handleFiltrar=()=>{const filtrosParaEnviar={...filtros};if(filtrosParaEnviar.dataInicial||filtrosParaEnviar.dataFinal){if(!filtrosParaEnviar.dataInicial||!filtrosParaEnviar.dataFinal){alert(\"Por favor, preencha ambas as datas para filtrar por período.\");return;}const dataInicial=new Date(filtrosParaEnviar.dataInicial);const dataFinal=new Date(filtrosParaEnviar.dataFinal);if(dataInicial>dataFinal){alert(\"A data inicial não pode ser maior que a data final.\");return;}filtrosParaEnviar.dataInicial=dataInicial.toISOString().split(\"T\")[0];filtrosParaEnviar.dataFinal=dataFinal.toISOString().split(\"T\")[0];}if(filtrosParaEnviar.motorista===\"todos\")delete filtrosParaEnviar.motorista;if(filtrosParaEnviar.status===\"todos\")delete filtrosParaEnviar.status;if(!filtrosParaEnviar.dataInicial)delete filtrosParaEnviar.dataInicial;if(!filtrosParaEnviar.dataFinal)delete filtrosParaEnviar.dataFinal;onFiltrar(filtrosParaEnviar);};const limparFiltros=()=>{setFiltros({dataInicial:\"\",dataFinal:\"\",motorista:\"todos\",status:\"todos\"});onFiltrar({});};const motoristasFiltrados=useMemo(()=>{return motoristas.map(motorista=>/*#__PURE__*/_jsxs(\"option\",{value:motorista._id,children:[motorista.nome,\" (\",motorista.status===\"em_viagem\"?\"Em viagem\":\"Disponível\",\")\"]},motorista._id));},[motoristas]);return/*#__PURE__*/_jsxs(\"div\",{className:\"card mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header custom-card-header2 text-white d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"mb-0\",children:\"Filtros\"}),/*#__PURE__*/_jsx(\"button\",{onClick:limparFiltros,className:\"btn btn-sm btn-outline-light\",disabled:loading,children:\"Limpar\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row g-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"dataInicial\",className:\"form-label\",children:\"Data Inicial\"}),/*#__PURE__*/_jsx(\"input\",{id:\"dataInicial\",type:\"date\",className:\"form-control text-black\",value:filtros.dataInicial,onChange:e=>setFiltros({...filtros,dataInicial:e.target.value}),max:filtros.dataFinal||undefined})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"dataFinal\",className:\"form-label\",children:\"Data Final\"}),/*#__PURE__*/_jsx(\"input\",{id:\"dataFinal\",type:\"date\",className:\"form-control text-black\",value:filtros.dataFinal,onChange:e=>setFiltros({...filtros,dataFinal:e.target.value}),min:filtros.dataInicial||undefined})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"motorista\",className:\"form-label\",children:\"Motoristas\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"motorista\",className:\"form-select text-black\",value:filtros.motorista,onChange:e=>setFiltros({...filtros,motorista:e.target.value}),disabled:loading,children:[/*#__PURE__*/_jsx(\"option\",{value:\"todos\",children:\"Todos os motoristas\"}),motoristasFiltrados]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"status\",className:\"form-label\",children:\"Status\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"status\",className:\"form-select text-black\",value:filtros.status,onChange:e=>setFiltros({...filtros,status:e.target.value}),disabled:loading,children:[/*#__PURE__*/_jsx(\"option\",{value:\"todos\",children:\"Todos status\"}),/*#__PURE__*/_jsx(\"option\",{value:\"em_andamento\",children:\"Em andamento\"}),/*#__PURE__*/_jsx(\"option\",{value:\"finalizada\",children:\"Finalizada\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cancelada\",children:\"Cancelada\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3 d-flex align-items-end\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleFiltrar,className:\"btn btn-primary w-100\",disabled:loading,children:loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"spinner-border spinner-border-sm me-2\"}),\"Filtrando...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-filter me-2\"}),\"Filtrar\"]})})})]})})]});};export default Filtros;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}