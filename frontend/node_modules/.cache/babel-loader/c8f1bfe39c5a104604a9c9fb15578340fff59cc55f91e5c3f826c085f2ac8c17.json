{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useViagemForm}from\"../../hooks/useViagemForm\";import socket from\"../../utils/socket\";import Modal from\"react-bootstrap/Modal\";import Button from\"react-bootstrap/Button\";import\"../../styles/SolicitarViagem/solicitarviagem.css\";import\"../../styles/SolicitarViagem/model.css\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function SolicitacaoPage(){const{formData,setFormData,formErrors,setFormErrors,loading,submitSuccess,handleChange,handleBlur,handleSubmit,validateField}=useViagemForm(socket);const[showUrgenteModal,setShowUrgenteModal]=useState(false);const[horaAtual,setHoraAtual]=useState(\"\");const[setores,setSetores]=useState([]);useEffect(()=>{const agora=new Date();const horas=String(agora.getHours()).padStart(2,\"0\");const minutos=String(agora.getMinutes()).padStart(2,\"0\");setHoraAtual(`${horas}:${minutos}`);},[]);// Carrega os setores do backend\nuseEffect(()=>{const fetchSetores=async()=>{try{const res=await fetch(`${process.env.REACT_APP_API_URL||\"http://192.168.0.160:1120/api\"}/setores`);const data=await res.json();setSetores(data);}catch(error){console.error(\"Erro ao buscar setores:\",error);}};fetchSetores();},[]);const getMinDate=tipo=>{const hoje=new Date();if(tipo===\"urgente\")return hoje.toISOString().split(\"T\")[0];const minimo24h=new Date(hoje.getTime()+24*60*60*1000);return minimo24h.toISOString().split(\"T\")[0];};const handleNormalSubmit=e=>{e.preventDefault();const data={...formData,tipo:\"normal\"};const errors={};if(!data[\"saida-data\"]||!data[\"saida-hora\"]){errors[\"saida-data\"]=\"Data e hora são obrigatórias\";}else{const saida=new Date(`${data[\"saida-data\"]}T${data[\"saida-hora\"]}`);const minimo24h=new Date(new Date().getTime()+24*60*60*1000);if(saida<minimo24h){errors[\"saida-data\"]=\"Necessário 24h de antecedência\";}}if(Object.keys(errors).length>0){setFormErrors(prev=>({...prev,...errors}));return;}handleSubmit(e,data);};const confirmarUrgente=()=>{const hoje=new Date().toISOString().split(\"T\")[0];const dadosUrgente={...formData,tipo:\"urgente\",\"saida-data\":hoje,\"saida-hora\":horaAtual,observacoes:formData.observacoes||\"Viagem urgente - justificativa necessária\"};const errors={\"saida-data\":validateField(\"saida-data\",hoje,dadosUrgente),observacoes:validateField(\"observacoes\",dadosUrgente.observacoes,dadosUrgente)};if(errors[\"saida-data\"]||errors.observacoes){setFormErrors(prev=>({...prev,...errors}));setShowUrgenteModal(false);return;}setFormData(dadosUrgente);setShowUrgenteModal(false);setTimeout(()=>{handleSubmit(new Event(\"submit\"),dadosUrgente);},100);};return/*#__PURE__*/_jsxs(\"div\",{className:\"container solicitar-viagem-container\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"mb-4 text-center d-flex align-items-center justify-content-center\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-map-marker-alt me-2\"}),\"Solicitar Viagem\"]}),/*#__PURE__*/_jsxs(\"form\",{id:\"form-viagem\",className:\"needs-validation\",noValidate:true,onSubmit:e=>e.preventDefault(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 mb-3\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"local\",className:\"form-label\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-map-marker-alt me-2\"}),\"Local de Destino*\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"local\",className:`form-control ${formErrors.local?\"is-invalid\":\"\"}`,value:formData.local,onChange:handleChange,onBlur:handleBlur,required:true}),formErrors.local&&/*#__PURE__*/_jsx(\"div\",{className:\"invalid-feedback\",children:formErrors.local})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 mb-3\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"passageiros\",className:\"form-label\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-users me-2\"}),\"N\\xBA de Passageiros*\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"passageiros\",min:\"1\",max:\"4\",className:`form-control ${formErrors.passageiros?\"is-invalid\":\"\"}`,value:formData.passageiros,onChange:handleChange,onBlur:handleBlur,required:true}),formErrors.passageiros&&/*#__PURE__*/_jsx(\"div\",{className:\"invalid-feedback\",children:formErrors.passageiros})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 mb-3\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"setor\",className:\"form-label\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-building me-2\"}),\"Setor Solicitante*\"]}),/*#__PURE__*/_jsxs(\"select\",{name:\"setor\",className:`form-control ${formErrors.setor?\"is-invalid\":\"\"}`,value:formData.setor,onChange:handleChange,onBlur:handleBlur,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Selecione um setor\"}),setores.map(s=>/*#__PURE__*/_jsxs(\"option\",{value:s.nome,children:[s.sigla,\" - \",s.nome]},s._id))]}),formErrors.setor&&/*#__PURE__*/_jsx(\"div\",{className:\"invalid-feedback\",children:formErrors.setor})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 mb-3\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"form-label\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-clock me-2\"}),\"Data/Hora de Sa\\xEDda*\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"saida-data\",className:`form-control ${formErrors[\"saida-data\"]?\"is-invalid\":\"\"}`,min:getMinDate(formData.tipo),value:formData[\"saida-data\"],onChange:handleChange,onBlur:handleBlur,required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"time\",name:\"saida-hora\",className:`form-control ${formErrors[\"saida-hora\"]?\"is-invalid\":\"\"}`,value:formData[\"saida-hora\"],onChange:handleChange,onBlur:handleBlur,required:true})]}),formErrors[\"saida-data\"]&&/*#__PURE__*/_jsx(\"div\",{className:\"invalid-feedback d-block\",children:formErrors[\"saida-data\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"observacoes\",className:\"form-label\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sticky-note me-2\"}),\"Observa\\xE7\\xF5es \",formData.tipo===\"urgente\"&&\"*\"]}),/*#__PURE__*/_jsx(\"textarea\",{name:\"observacoes\",className:`form-control ${formErrors.observacoes?\"is-invalid\":\"\"}`,rows:\"3\",value:formData.observacoes,onChange:handleChange,onBlur:handleBlur,placeholder:formData.tipo===\"urgente\"?\"Justifique a necessidade urgente (mín. 10 caracteres)\":\"Informações adicionais (opcional)\"}),formErrors.observacoes&&/*#__PURE__*/_jsx(\"div\",{className:\"invalid-feedback\",children:formErrors.observacoes})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-center gap-3 mt-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary btn-lg\",onClick:handleNormalSubmit,disabled:loading,children:loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-spinner fa-spin me-2\"}),\"Enviando...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-paper-plane me-2\"}),\"Solicitar Normal\"]})}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-danger btn-lg\",onClick:()=>setShowUrgenteModal(true),disabled:loading,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-bolt me-2\"}),\"Solicita\\xE7\\xE3o Urgente\"]})]}),submitSuccess&&/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-success mt-3 text-center\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-check-circle me-2\"}),\"Solicita\\xE7\\xE3o registrada com sucesso!\"]})]}),/*#__PURE__*/_jsxs(Modal,{show:showUrgenteModal,onHide:()=>setShowUrgenteModal(false),centered:true,className:\"modal-urgente\",contentClassName:\"modal-urgente-content\",backdropClassName:\"modal-urgente-backdrop\",children:[/*#__PURE__*/_jsx(Modal.Header,{className:\"modal-urgente-header\",closeButton:true,children:/*#__PURE__*/_jsxs(Modal.Title,{className:\"modal-urgente-title\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-exclamation-triangle modal-urgente-icon me-2\"}),\"Confirma\\xE7\\xE3o de Viagem Urgente\"]})}),/*#__PURE__*/_jsxs(Modal.Body,{className:\"modal-urgente-body\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"modal-urgente-text\",children:[\"Voc\\xEA est\\xE1 solicitando uma viagem\",\" \",/*#__PURE__*/_jsx(\"strong\",{className:\"modal-urgente-alert\",children:\"URGENTE\"}),\" para:\"]}),/*#__PURE__*/_jsxs(\"ul\",{className:\"modal-urgente-list\",children:[/*#__PURE__*/_jsxs(\"li\",{className:\"modal-urgente-item\",children:[\"Data: \",/*#__PURE__*/_jsx(\"strong\",{children:new Date().toLocaleDateString()})]}),/*#__PURE__*/_jsxs(\"li\",{className:\"modal-urgente-item\",children:[\"Hora: \",/*#__PURE__*/_jsx(\"strong\",{children:horaAtual})]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"modal-urgente-warning\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-exclamation-circle modal-urgente-icon me-2\"}),\"Justifique a necessidade no campo de observa\\xE7\\xF5es\"]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{className:\"modal-urgente-footer\",children:[/*#__PURE__*/_jsx(Button,{className:\"modal-urgente-btn modal-urgente-btn-cancel\",onClick:()=>setShowUrgenteModal(false),children:\"Cancelar\"}),/*#__PURE__*/_jsx(Button,{className:\"modal-urgente-btn modal-urgente-btn-confirm\",onClick:confirmarUrgente,children:\"Confirmar Urg\\xEAncia\"})]})]})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}